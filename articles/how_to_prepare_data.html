<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SuperCellCyto">
<title>Preparing Data for SuperCellCyto • SuperCellCyto</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparing Data for SuperCellCyto">
<meta property="og:description" content="SuperCellCyto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SuperCellCyto</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how_to_create_supercells.html">How to create supercells</a>
    <a class="dropdown-item" href="../articles/how_to_prepare_data.html">Preparing Data for SuperCellCyto</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Preparing Data for SuperCellCyto</h1>
                        <h4 data-toc-skip class="author">Givanna
Putri</h4>
            
      
      
      <div class="d-none name"><code>how_to_prepare_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="performing-quality-control">Performing Quality Control<a class="anchor" aria-label="anchor" href="#performing-quality-control"></a>
</h2>
<p>Prior to creating supercells, it’s crucial to ensure that your
dataset has undergone thorough quality control (QC). We want to retain
only single, live cells and remove any debris, doublets, or dead cells.
Additionally, it is also important to perform compensation to correct
for fluorescence spillover (for Flow data) or to adjust for signal
overlap or spillover between different metal isotopse (for Cytof data).
A well-prepared dataset is key to obtaining reliable supercells from
SuperCellCyto.</p>
<p>Several R packages are available for performing QC on cytometry data.
Notable among these are <a href="https://onlinelibrary.wiley.com/doi/10.1002/cyto.a.24501" class="external-link">PeacoQC</a>,
<a href="https://bioconductor.org/packages/release/bioc/html/CATALYST.html" class="external-link">CATALYST</a>,
and <a href="https://dillonhammill.github.io/CytoExploreR/" class="external-link">CytoExploreR</a>.
These packages are well maintained and are continuously updated. To make
sure that the information we provide do not quickly go out of date, we
highly recommend you to consult the packages’ respective vignettes for
detailed guidance on how to use them to QC your data.</p>
<p>If you prefer using manual gating to do QC, you can also use FlowJo.
For a comprehensive guide on using FlowJo for prepare your data, please
read this <a href="https://wiki.centenary.org.au/display/SPECTRE/Exporting+data+from+FlowJo+for+analysis+in+Spectre" class="external-link">vignette</a>.
The steps taken in that vignette to do QC is perfectly adequate for
SuperCellCyto.</p>
<p>In our manuscript, we used <code>CytoExploreR</code> to QC the
<code>Oetjen_bcell</code> flow cytometry data and <code>CATALYST</code>
to QC the <code>Trussart_cytofruv</code> Cytof data.</p>
<p>The specific scripts used can be found in our <a href="https://github.com/phipsonlab/SuperCellCyto-analysis/tree/master/code" class="external-link">Github
repository</a>:</p>
<ol style="list-style-type: decimal">
<li>
<code>b_cell_identification/gate_flow_data.R</code> for
<code>Oetjen_bcell</code> data.</li>
<li>
<code>batch_correction/prepare_data.R</code> for
<code>Trussart_cytofruv</code> data. These scripts were adapted from
those used in the <a href="https://elifesciences.org/articles/59630" class="external-link">CytofRUV
manuscript</a>.</li>
</ol>
<p>For Oetjen_bcell data, we used the following gating strategy post
compensation:</p>
<ol style="list-style-type: decimal">
<li>FSC-H and FSC-A to isolate only the single events. (Also check SSC-H
vs SSC-A).</li>
<li>FSC-A and SSC-A to remove debris.</li>
<li>Live/Dead and SSC-A to isolate live cells.</li>
</ol>
<p>The following is the resulting single live cells manually gated for
the <code>Oetjen_bcell</code> data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"figures/oetjen_bcell_single_live_cells.png"</span>, error <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/oetjen_bcell_single_live_cells.png" width="1800"></p>
<p>After completing the QC process, you will have clean data in either
CSV or FCS file formats. The next section will guide you on how to load
these files and proceed with preparing your data for SuperCellCyto.</p>
</div>
<div class="section level2">
<h2 id="preparing-fcscsv-files-for-supercellcyto">Preparing FCS/CSV files for SuperCellCyto<a class="anchor" aria-label="anchor" href="#preparing-fcscsv-files-for-supercellcyto"></a>
</h2>
<p>To use SuperCellCyto, your input data must be formatted as a <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="external-link">data.table</a>
object. Briefly, <code>data.table</code> is an enhanced version of R
native <code>data.frame</code> object. It is a package that offers fast
processing of large <code>data.frame</code>.</p>
<p>Additionally, each cell in your <code>data.table</code> must also
have a unique identifier and be associated with a sample, typically the
biological sample it came from.</p>
<div class="section level3">
<h3 id="preparing-csv-files">Preparing CSV files<a class="anchor" aria-label="anchor" href="#preparing-csv-files"></a>
</h3>
<p>Loading CSV files into a <code>data.table</code> object is
straightforward. We can use the <code>fread</code> function from the
<code>data.table</code> package.</p>
<p>Here’s how to install it:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"data.table"</span><span class="op">)</span></span></code></pre></div>
<p>For this example, let’s load two CSV files containing subsampled data
from the <code>Levine_32dim</code> dataset we used in SuperCellCyto
manuscript. Each file represents a sample (H1 and H2), with the sample
name appended to the file name:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">csv_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data/Levine_32dim_H1.csv"</span>, <span class="st">"data/Levine_32dim_H2.csv"</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H1"</span>, <span class="st">"H2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">csv_file</span> <span class="op">&lt;-</span> <span class="va">csv_files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">sample</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">dat_a_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">csv_file</span><span class="op">)</span></span>
<span>  <span class="va">dat_a_sample</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="va">sample</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dat_a_sample</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span><span class="op">[</span>, <span class="va">cell_id</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Cell_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Time Cell_length      DNA1     DNA2   CD45RA       CD133       CD19</span></span>
<span><span class="co">#&gt; 1: 307428          27 169.91125 262.3192 2.338830 -0.15333985 -0.2056334</span></span>
<span><span class="co">#&gt; 2:  80712          13  50.91230 181.1320 2.129232  3.35638666 -0.1013980</span></span>
<span><span class="co">#&gt; 3: 111390          16 126.93545 269.4199 1.613719 -0.07193317  0.1116483</span></span>
<span><span class="co">#&gt; 4:  14088          31 142.67317 283.4645 4.100985  0.09366111 19.4974289</span></span>
<span><span class="co">#&gt; 5: 284190          53  98.28069 187.2090 4.289627  0.56254190 12.2265682</span></span>
<span><span class="co">#&gt; 6: 481997          35 112.29634 162.4416 6.089430  0.01665318 -0.1943735</span></span>
<span><span class="co">#&gt;           CD22       CD11b        CD4          CD8        CD34        Flt3</span></span>
<span><span class="co">#&gt; 1: -0.19720075 32.13040161 0.78105438 -0.071934469  1.53498471  0.84833205</span></span>
<span><span class="co">#&gt; 2:  3.05647945 14.23928833 0.53373063 -0.007943562 -0.09401329 -0.13234507</span></span>
<span><span class="co">#&gt; 3: -0.07421356  2.20701027 9.75063324 -0.034266483  0.53720337 -0.05749827</span></span>
<span><span class="co">#&gt; 4:  5.07963181 -0.07880223 0.05995781  0.009049721 -0.19206744  3.36803102</span></span>
<span><span class="co">#&gt; 5: 10.81768703  1.82670891 1.30010796 -0.187664956  2.05419374  2.72891521</span></span>
<span><span class="co">#&gt; 6:  1.43817198  5.79350042 0.64789140 54.004249573  0.28843120  1.01514077</span></span>
<span><span class="co">#&gt;           CD20    CXCR4     CD235ab     CD45       CD123     CD321        CD14</span></span>
<span><span class="co">#&gt; 1: -0.08676258 3.488938  0.82301176 313.8038  0.30909532 46.484669  0.05072345</span></span>
<span><span class="co">#&gt; 2: -0.04217101 1.364644 -0.13094166 207.2459  1.76594567 22.532978 -0.19256826</span></span>
<span><span class="co">#&gt; 3:  0.09777651 3.880993  2.00220966 750.4200 -0.06809702  9.515447 -0.05956535</span></span>
<span><span class="co">#&gt; 4:  0.64118648 2.911314 -0.08744399 169.4798  1.25776207  9.218699  1.09861076</span></span>
<span><span class="co">#&gt; 5: 15.34162998 9.303430  6.34135485 751.0563  0.05031190 10.463912  1.11993504</span></span>
<span><span class="co">#&gt; 6:  3.84020925 3.520693  2.93023992 868.4937 -0.04488884 19.107010  0.62120903</span></span>
<span><span class="co">#&gt;           CD33     CD47       CD11c          CD7      CD15        CD16</span></span>
<span><span class="co">#&gt; 1:  2.09802437 20.96871 20.76318550 -0.007966662 0.7279212 -0.03067662</span></span>
<span><span class="co">#&gt; 2:  7.35230541 27.49848 15.13398170 -0.087256350 0.7187206  0.41139653</span></span>
<span><span class="co">#&gt; 3: -0.16046160 53.51268 -0.19080050  1.044164538 2.1075230 -0.14510959</span></span>
<span><span class="co">#&gt; 4:  0.18614264 55.07846 -0.07061907  0.948859751 1.2470639  1.12294865</span></span>
<span><span class="co">#&gt; 5:  0.15872155 40.63973  4.64010382 -0.195279136 4.5712810 -0.10192144</span></span>
<span><span class="co">#&gt; 6: -0.09832545 29.65497  6.15759659 12.104630470 0.5801706 -0.11606000</span></span>
<span><span class="co">#&gt;         CD44        CD38      CD13         CD3       CD61       CD117     CD49d</span></span>
<span><span class="co">#&gt; 1:  95.71002   5.1124768 5.1056433   0.5827813 -0.1684093 -0.02967962  6.557199</span></span>
<span><span class="co">#&gt; 2: 185.51929   7.4784145 0.3580886   1.8861074  1.9233229 -0.14122920  1.088500</span></span>
<span><span class="co">#&gt; 3:  33.95839   0.6161237 0.3045178 462.1258240  0.7625037 -0.03500306  5.997476</span></span>
<span><span class="co">#&gt; 4:  32.46420 249.4612885 1.2526705   0.7302832  3.2274778 -0.18526185  8.533935</span></span>
<span><span class="co">#&gt; 5:  98.09428  43.5352974 2.8327518   0.1868679  2.1032026  0.01776284 12.400333</span></span>
<span><span class="co">#&gt; 6:  65.91293   2.0126576 1.2817017 390.3737793  2.4605207  0.33154550  5.214703</span></span>
<span><span class="co">#&gt;        HLA-DR       CD64         CD41  Viability file_number event_number</span></span>
<span><span class="co">#&gt; 1: 112.467545  6.9157209  0.083808646  1.7268630          94       257088</span></span>
<span><span class="co">#&gt; 2:  12.206795 30.7242870  7.753727913  3.7120194          94        80655</span></span>
<span><span class="co">#&gt; 3:  -0.046793 -0.1739236 -0.080375805  0.7011412          94       116394</span></span>
<span><span class="co">#&gt; 4:   8.965122  0.3391838 -0.005531122  0.2978864          94         5618</span></span>
<span><span class="co">#&gt; 5: 174.952667  0.4361930  1.834125400 13.2743187          94       241699</span></span>
<span><span class="co">#&gt; 6:   0.648035 -0.1803290  0.389085352  0.4543665          94       363564</span></span>
<span><span class="co">#&gt;    sample cell_id</span></span>
<span><span class="co">#&gt; 1:     H1  Cell_1</span></span>
<span><span class="co">#&gt; 2:     H1  Cell_2</span></span>
<span><span class="co">#&gt; 3:     H1  Cell_3</span></span>
<span><span class="co">#&gt; 4:     H1  Cell_4</span></span>
<span><span class="co">#&gt; 5:     H1  Cell_5</span></span>
<span><span class="co">#&gt; 6:     H1  Cell_6</span></span></code></pre></div>
<p>Let’s break down what we have done:</p>
<ol style="list-style-type: decimal">
<li>We specify the location of the csv files in <code>csv_files</code>
vector and their corresponding sample names in <code>samples</code>
vector. <code>data/Levine_32dim_H1.csv</code> belongs to sample H1 while
<code>data/Levine_32dim_H2.csv</code> belongs to sample H2.</li>
<li>We use <code>lapply</code> to simultaneously iterate over each
element in the <code>csv_files</code> and <code>samples</code> vector.
For each csv file and the corresponding sample, we read the csv file
into the variable <code>dat_a_sample</code> using <code>fread</code>
function. We then assign the sample id in a new column called
<code>sample</code>. As a result, we get a list <code>dat</code>
containing 2 <code>data.table</code> objects, 1 object per csv
file.</li>
<li>We use <code>rbindlist</code> function from the
<code>data.table</code> package to merge list into one
<code>data.table</code> object.</li>
<li>We create a new column <code>cell_id</code> which gives each cell a
unique id such as <code>Cell_1</code>, <code>Cell_2</code>, etc. up
until <code>Cell_2000</code> (we have in total 2,000 cells).</li>
</ol>
</div>
<div class="section level3">
<h3 id="preparing-fcs-files">Preparing FCS files<a class="anchor" aria-label="anchor" href="#preparing-fcs-files"></a>
</h3>
<p>FCS files, commonly used in cytometry, require specific handling. The
<a href="https://github.com/immuneDynamics/Spectre/" class="external-link">Spectre</a> package
is an excellent tool for this purpose.</p>
<p>You can install Spectre using the remotes package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"immunedynamics/Spectre"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s load two FCS files from the <code>Trussart_cytofruv</code>
dataset we used in our manuscript.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Spectre</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_list</span> <span class="op">&lt;-</span> <span class="fu">read.files</span><span class="op">(</span>file.loc <span class="op">=</span> <span class="st">"data"</span>, file.type <span class="op">=</span> <span class="st">".fcs"</span><span class="op">)</span></span></code></pre></div>
<p>Spectre’s <code>read.files</code> reads FCS files into a list of
<code>data.table</code> objects, one for each file. For each
<code>data.table</code> object, it will also add a column
<code>FileName</code> denoting the name of the file the cell come from,
which we can then use add sample information for the cells.</p>
<p>For this dataset, both FCS files contain data belonging to a patient
(let’s call him B2). The file with name “B2” contains the patient’s
sample quantified in batch 1, and the file with name “Run3_B2” contains
the patient’s sample quantified in batch 2. Let’s name these samples
“B2_batch1” and “B2_batch2”.</p>
<p>Now, let’s merge <code>data.table</code> objects and add sample
information. We will use <code>rbindlist</code> to merge the list into
one <code>data.table</code> object and then add the sample information
as a column. The latter is done by first creating a new
<code>data.table</code> object containing the mapping of FileName and
the sample name, and then using <code>merge.data.table</code> to add
them into our <code>data.table</code> object.</p>
<p>We will also to create a new column <code>cell_id</code> which gives
each cell a unique id such as <code>Cell_1</code>, <code>Cell_2</code>,
etc.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_cytof</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">dat_list</span><span class="op">)</span></span>
<span><span class="va">sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B2_batch1"</span>, <span class="st">"B2_batch2"</span><span class="op">)</span>,</span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B2"</span>, <span class="st">"Run3_B2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dat_with_sample_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge.data.table</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">dat_cytof</span>,</span>
<span>  y <span class="op">=</span> <span class="va">sample_info</span>,</span>
<span>  by.x <span class="op">=</span> <span class="st">"FileName"</span>,</span>
<span>  by.y <span class="op">=</span> <span class="st">"filename"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_with_sample_info</span><span class="op">[</span>, <span class="va">cell_id</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Cell_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_with_sample_info</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>With CSV and FCS files loaded as data.table objects, the next step is
to transform the data appropriately for SuperCellCyto.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-transformation">Data Transformation<a class="anchor" aria-label="anchor" href="#data-transformation"></a>
</h2>
<p>Before using SuperCellCyto, it’s essential to apply appropriate data
transformations. These transformations are crucial for accurate
analysis, as explained in this <a href="https://wiki.centenary.org.au/display/SPECTRE/Data+transformation" class="external-link">article
on data transformation</a>.</p>
<p><strong>Note</strong>: If you have completed the QC process as
outlined <a href="https://wiki.centenary.org.au/display/SPECTRE/Exporting+data+from+FlowJo+for+analysis+in+Spectre" class="external-link">here</a>
and have CSV files exported from FlowJo, you can proceed directly to the
next vignette on how to create supercells. For more details on different
file types (FCS, CSV scale, and CSV channel value), refer to this <a href="https://wiki.centenary.org.au/display/SPECTRE/Exporting+data+from+FlowJo+for+analysis+in+Spectre" class="external-link">guide</a>.</p>
<p>A common method for data transformation in cytometry is the arcsinh
transformation, an <a href="https://mathworld.wolfram.com/InverseHyperbolicSine.html" class="external-link">inverse
hyperbolic arcsinh transformation</a>. The transformation requires
specifying a cofactor, which affects the representation of the low-end
data. Typically, a cofactor of 5 is used for Cytof data and 150 for Flow
data. This vignette will focus on the transformation process rather than
cofactor selection. For more in-depth information on choosing a
cofactor, read this detailed <a href="https://wiki.centenary.org.au/display/SPECTRE/Data+transformation" class="external-link">article</a>.</p>
<p>We’ll use the <code>Levine_32dim</code> dataset loaded earlier from
CSV files:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Time Cell_length      DNA1     DNA2   CD45RA       CD133       CD19</span></span>
<span><span class="co">#&gt; 1: 307428          27 169.91125 262.3192 2.338830 -0.15333985 -0.2056334</span></span>
<span><span class="co">#&gt; 2:  80712          13  50.91230 181.1320 2.129232  3.35638666 -0.1013980</span></span>
<span><span class="co">#&gt; 3: 111390          16 126.93545 269.4199 1.613719 -0.07193317  0.1116483</span></span>
<span><span class="co">#&gt; 4:  14088          31 142.67317 283.4645 4.100985  0.09366111 19.4974289</span></span>
<span><span class="co">#&gt; 5: 284190          53  98.28069 187.2090 4.289627  0.56254190 12.2265682</span></span>
<span><span class="co">#&gt; 6: 481997          35 112.29634 162.4416 6.089430  0.01665318 -0.1943735</span></span>
<span><span class="co">#&gt;           CD22       CD11b        CD4          CD8        CD34        Flt3</span></span>
<span><span class="co">#&gt; 1: -0.19720075 32.13040161 0.78105438 -0.071934469  1.53498471  0.84833205</span></span>
<span><span class="co">#&gt; 2:  3.05647945 14.23928833 0.53373063 -0.007943562 -0.09401329 -0.13234507</span></span>
<span><span class="co">#&gt; 3: -0.07421356  2.20701027 9.75063324 -0.034266483  0.53720337 -0.05749827</span></span>
<span><span class="co">#&gt; 4:  5.07963181 -0.07880223 0.05995781  0.009049721 -0.19206744  3.36803102</span></span>
<span><span class="co">#&gt; 5: 10.81768703  1.82670891 1.30010796 -0.187664956  2.05419374  2.72891521</span></span>
<span><span class="co">#&gt; 6:  1.43817198  5.79350042 0.64789140 54.004249573  0.28843120  1.01514077</span></span>
<span><span class="co">#&gt;           CD20    CXCR4     CD235ab     CD45       CD123     CD321        CD14</span></span>
<span><span class="co">#&gt; 1: -0.08676258 3.488938  0.82301176 313.8038  0.30909532 46.484669  0.05072345</span></span>
<span><span class="co">#&gt; 2: -0.04217101 1.364644 -0.13094166 207.2459  1.76594567 22.532978 -0.19256826</span></span>
<span><span class="co">#&gt; 3:  0.09777651 3.880993  2.00220966 750.4200 -0.06809702  9.515447 -0.05956535</span></span>
<span><span class="co">#&gt; 4:  0.64118648 2.911314 -0.08744399 169.4798  1.25776207  9.218699  1.09861076</span></span>
<span><span class="co">#&gt; 5: 15.34162998 9.303430  6.34135485 751.0563  0.05031190 10.463912  1.11993504</span></span>
<span><span class="co">#&gt; 6:  3.84020925 3.520693  2.93023992 868.4937 -0.04488884 19.107010  0.62120903</span></span>
<span><span class="co">#&gt;           CD33     CD47       CD11c          CD7      CD15        CD16</span></span>
<span><span class="co">#&gt; 1:  2.09802437 20.96871 20.76318550 -0.007966662 0.7279212 -0.03067662</span></span>
<span><span class="co">#&gt; 2:  7.35230541 27.49848 15.13398170 -0.087256350 0.7187206  0.41139653</span></span>
<span><span class="co">#&gt; 3: -0.16046160 53.51268 -0.19080050  1.044164538 2.1075230 -0.14510959</span></span>
<span><span class="co">#&gt; 4:  0.18614264 55.07846 -0.07061907  0.948859751 1.2470639  1.12294865</span></span>
<span><span class="co">#&gt; 5:  0.15872155 40.63973  4.64010382 -0.195279136 4.5712810 -0.10192144</span></span>
<span><span class="co">#&gt; 6: -0.09832545 29.65497  6.15759659 12.104630470 0.5801706 -0.11606000</span></span>
<span><span class="co">#&gt;         CD44        CD38      CD13         CD3       CD61       CD117     CD49d</span></span>
<span><span class="co">#&gt; 1:  95.71002   5.1124768 5.1056433   0.5827813 -0.1684093 -0.02967962  6.557199</span></span>
<span><span class="co">#&gt; 2: 185.51929   7.4784145 0.3580886   1.8861074  1.9233229 -0.14122920  1.088500</span></span>
<span><span class="co">#&gt; 3:  33.95839   0.6161237 0.3045178 462.1258240  0.7625037 -0.03500306  5.997476</span></span>
<span><span class="co">#&gt; 4:  32.46420 249.4612885 1.2526705   0.7302832  3.2274778 -0.18526185  8.533935</span></span>
<span><span class="co">#&gt; 5:  98.09428  43.5352974 2.8327518   0.1868679  2.1032026  0.01776284 12.400333</span></span>
<span><span class="co">#&gt; 6:  65.91293   2.0126576 1.2817017 390.3737793  2.4605207  0.33154550  5.214703</span></span>
<span><span class="co">#&gt;        HLA-DR       CD64         CD41  Viability file_number event_number</span></span>
<span><span class="co">#&gt; 1: 112.467545  6.9157209  0.083808646  1.7268630          94       257088</span></span>
<span><span class="co">#&gt; 2:  12.206795 30.7242870  7.753727913  3.7120194          94        80655</span></span>
<span><span class="co">#&gt; 3:  -0.046793 -0.1739236 -0.080375805  0.7011412          94       116394</span></span>
<span><span class="co">#&gt; 4:   8.965122  0.3391838 -0.005531122  0.2978864          94         5618</span></span>
<span><span class="co">#&gt; 5: 174.952667  0.4361930  1.834125400 13.2743187          94       241699</span></span>
<span><span class="co">#&gt; 6:   0.648035 -0.1803290  0.389085352  0.4543665          94       363564</span></span>
<span><span class="co">#&gt;    sample cell_id</span></span>
<span><span class="co">#&gt; 1:     H1  Cell_1</span></span>
<span><span class="co">#&gt; 2:     H1  Cell_2</span></span>
<span><span class="co">#&gt; 3:     H1  Cell_3</span></span>
<span><span class="co">#&gt; 4:     H1  Cell_4</span></span>
<span><span class="co">#&gt; 5:     H1  Cell_5</span></span>
<span><span class="co">#&gt; 6:     H1  Cell_6</span></span></code></pre></div>
<p>First, we need to select the markers to be transformed. Usually, all
markers should be transformed for SuperCellCyto. However, you can choose
to exclude specific markers if needed:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">markers_to_transform</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45RA"</span>,<span class="st">"CD133"</span>,<span class="st">"CD19"</span>,<span class="st">"CD22"</span>,<span class="st">"CD11b"</span>,<span class="st">"CD4"</span>,</span>
<span>                          <span class="st">"CD8"</span>,<span class="st">"CD34"</span>,<span class="st">"Flt3"</span>,<span class="st">"CD20"</span>,<span class="st">"CXCR4"</span>,<span class="st">"CD235ab"</span>,</span>
<span>                          <span class="st">"CD45"</span>,<span class="st">"CD123"</span>,<span class="st">"CD321"</span>,<span class="st">"CD14"</span>,<span class="st">"CD33"</span>,<span class="st">"CD47"</span>,<span class="st">"CD11c"</span>,</span>
<span>                          <span class="st">"CD7"</span>,<span class="st">"CD15"</span>,<span class="st">"CD16"</span>,<span class="st">"CD44"</span>,<span class="st">"CD38"</span>,<span class="st">"CD13"</span>,<span class="st">"CD3"</span>,<span class="st">"CD61"</span>,</span>
<span>                          <span class="st">"CD117"</span>,<span class="st">"CD49d"</span>,<span class="st">"HLA-DR"</span>,<span class="st">"CD64"</span>,<span class="st">"CD41"</span><span class="op">)</span></span></code></pre></div>
<p>For transformation, we’ll use a cofactor of 5 and apply the arcsinh
transformation using the Spectre package. If Spectre isn’t installed,
use:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"immunedynamics/Spectre"</span><span class="op">)</span></span></code></pre></div>
<p>Perform the transformation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">do.asinh</span><span class="op">(</span><span class="va">dat</span>, <span class="va">markers_to_transform</span>, cofactor <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>After transformation, new columns with “_asinh” appended indicate the
transformed markers.</p>
<p>With your data now transformed, you’re ready to create supercells
using SuperCellCyto. Please refer to our dedicated vignette for detailed
instructions.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Givanna Putri, George Howitt, Felix Marsh-Wakefield, Thomas Ashhurst, Belinda Phipson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
