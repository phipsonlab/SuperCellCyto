<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SuperCellCyto">
<title>Using SuperCellCyto for Stratified Summarising • SuperCellCyto</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using SuperCellCyto for Stratified Summarising">
<meta property="og:description" content="SuperCellCyto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SuperCellCyto</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how_to_create_supercells.html">How to create supercells</a>
    <a class="dropdown-item" href="../articles/how_to_prepare_data.html">How to Prepare Data for SuperCellCyto</a>
    <a class="dropdown-item" href="../articles/interoperability_with_sce.html">Interoperability with SingleCellExperiment</a>
    <a class="dropdown-item" href="../articles/interoperability_with_seurat.html">Interoperability with Seurat</a>
    <a class="dropdown-item" href="../articles/using_supercellcyto_for_stratified_summarising.html">Using SuperCellCyto for Stratified Summarising</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using SuperCellCyto for Stratified Summarising</h1>
                        <h4 data-toc-skip class="author">Givanna
Putri</h4>
            
      
      
      <div class="d-none name"><code>using_supercellcyto_for_stratified_summarising.Rmd</code></div>
    </div>

    
    
<p>Have you been following the vignette on <a href="how_to_create_supercells.html">how to create supercells</a>, and
wonder whether it is possible to use <code>SuperCellCyto</code> as a
replacement for stratified sampling to avoid overcrowding UMAP/tSNE
plot?</p>
<p>The short answer to that is, yes we can. We call this
<strong>stratified summarising</strong>, and <code>SuperCellCyto</code>
can absolutely be used for this purpose. To do this, all we need to do
is simply set the sample column of our data to not be the biological
sample the cell came from, but rather` the column the we want to
stratify the data based on.</p>
<p>For example, when drawing UMAP or tSNE plot, we commonly subsample
each cluster or cell type to avoid crowding the plot. Instead of
subsampling, we can generate supercells for each cluster or cell type
simply by specifying the column that denotes the cluster or cell type
each cell belong to as the <code>sample_colname</code> parameter!</p>
<p>Let’s illustrate this using a clustered (using k-means) toy data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://phipsonlab.github.io/SuperCellCyto/">SuperCellCyto</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate some data</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simCytoData.html">simCytoData</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">markers_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Marker_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cell_id_col</span> <span class="op">&lt;-</span> <span class="st">"Cell_Id"</span></span>
<span></span>
<span><span class="co"># Run kmeans</span></span>
<span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">dat</span><span class="op">[</span>, <span class="va">markers_col</span>, with <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,</span>
<span>  centers <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">clust_col</span> <span class="op">&lt;-</span> <span class="st">"kmeans_clusters"</span></span>
<span><span class="va">dat</span><span class="op">[[</span><span class="va">clust_col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cluster_"</span>, <span class="va">clust</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<p>To perform stratified summarising, we supply the cluster column
(<code>kmeans_clusters</code> in the example above), as
<code>runSuperCellCyto</code>’s <code>sample_colname</code>
parameter.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">supercells</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSuperCellCyto.html">runSuperCellCyto</a></span><span class="op">(</span></span>
<span>  dt <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  markers <span class="op">=</span> <span class="va">markers_col</span>,</span>
<span>  sample_colname <span class="op">=</span> <span class="va">clust_col</span>,</span>
<span>  cell_id_colname <span class="op">=</span> <span class="va">cell_id_col</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, if we look at the <code>supercell_expression_matrix</code>, each
row (each supercell) will be denoted with the cluster it belongs to, and
<em>not the biological sample it came from</em>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inspect the top 3 and bottom 3 of the expression matrix and some columns.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kmeans_clusters"</span>, <span class="st">"SuperCellId"</span>, <span class="st">"Marker_10"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    kmeans_clusters                    SuperCellId Marker_10</span></span>
<span><span class="co">#&gt;             &lt;char&gt;                         &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:       cluster_4   SuperCell_1_Sample_cluster_4  14.64662</span></span>
<span><span class="co">#&gt; 2:       cluster_4   SuperCell_2_Sample_cluster_4  14.66858</span></span>
<span><span class="co">#&gt; 3:       cluster_4   SuperCell_3_Sample_cluster_4  14.41837</span></span>
<span><span class="co">#&gt; 4:       cluster_5 SuperCell_498_Sample_cluster_5  16.99003</span></span>
<span><span class="co">#&gt; 5:       cluster_5 SuperCell_499_Sample_cluster_5  17.09864</span></span>
<span><span class="co">#&gt; 6:       cluster_5 SuperCell_500_Sample_cluster_5  15.85447</span></span></code></pre></div>
<p>If we look at the number of supercells created and check how many
cells there were in each cluster, we will find that, for each cluster,
we get approximately <code>n_cells_in_the_cluster/20</code> where 20 is
the <code>gam</code> parameter value we used for
<code>runSuperCellCyto</code> (this is the default).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute how many cells per cluster, and divide by 20, the gamma value.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">kmeans_clusters</span><span class="op">)</span> <span class="op">/</span> <span class="fl">20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; cluster_1 cluster_2 cluster_3 cluster_4 cluster_5 </span></span>
<span><span class="co">#&gt;    120.25    130.30    119.75    129.70    500.00</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span><span class="op">$</span><span class="va">kmeans_clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; cluster_1 cluster_2 cluster_3 cluster_4 cluster_5 </span></span>
<span><span class="co">#&gt;       120       130       120       130       500</span></span></code></pre></div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] SuperCellCyto_0.1.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Matrix_1.6-5        jsonlite_1.8.8      compiler_4.3.2     </span></span>
<span><span class="co">#&gt;  [4] Rcpp_1.0.12         stringr_1.5.1       parallel_4.3.2     </span></span>
<span><span class="co">#&gt;  [7] SuperCell_1.0       jquerylib_0.1.4     systemfonts_1.0.5  </span></span>
<span><span class="co">#&gt; [10] textshaping_0.3.7   BiocParallel_1.36.0 yaml_2.3.8         </span></span>
<span><span class="co">#&gt; [13] fastmap_1.1.1       lattice_0.21-9      plyr_1.8.9         </span></span>
<span><span class="co">#&gt; [16] R6_2.5.1            igraph_2.0.1.1      knitr_1.45         </span></span>
<span><span class="co">#&gt; [19] desc_1.4.3          bslib_0.6.1         rlang_1.1.3        </span></span>
<span><span class="co">#&gt; [22] cachem_1.0.8        stringi_1.8.3       RANN_2.6.1         </span></span>
<span><span class="co">#&gt; [25] xfun_0.42           fs_1.6.3            sass_0.4.8         </span></span>
<span><span class="co">#&gt; [28] memoise_2.0.1       cli_3.6.2           pkgdown_2.0.7      </span></span>
<span><span class="co">#&gt; [31] magrittr_2.0.3      digest_0.6.34       grid_4.3.2         </span></span>
<span><span class="co">#&gt; [34] lifecycle_1.0.4     vctrs_0.6.5         evaluate_0.23      </span></span>
<span><span class="co">#&gt; [37] glue_1.7.0          data.table_1.15.0   codetools_0.2-19   </span></span>
<span><span class="co">#&gt; [40] ragg_1.2.7          rmarkdown_2.25      purrr_1.0.2        </span></span>
<span><span class="co">#&gt; [43] pkgconfig_2.0.3     tools_4.3.2         htmltools_0.5.7</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Givanna Putri, George Howitt, Felix Marsh-Wakefield, Thomas Ashhurst, Belinda Phipson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
