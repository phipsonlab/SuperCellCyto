<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interoperability with SingleCellExperiment • SuperCellCyto</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interoperability with SingleCellExperiment">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SuperCellCyto</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/how_to_create_supercells.html">How to create supercells</a></li>
    <li><a class="dropdown-item" href="../articles/how_to_prepare_data.html">How to Prepare Data for SuperCellCyto</a></li>
    <li><a class="dropdown-item" href="../articles/interoperability_with_sce.html">Interoperability with SingleCellExperiment</a></li>
    <li><a class="dropdown-item" href="../articles/interoperability_with_seurat.html">Interoperability with Seurat</a></li>
    <li><a class="dropdown-item" href="../articles/using_supercellcyto_for_stratified_summarising.html">Using SuperCellCyto for Stratified Summarising</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/phipsonlab/SuperCellCyto/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Interoperability with SingleCellExperiment</h1>
                        <h4 data-toc-skip class="author">Givanna
Putri</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phipsonlab/SuperCellCyto/blob/main/vignettes/interoperability_with_sce.Rmd" class="external-link"><code>vignettes/interoperability_with_sce.Rmd</code></a></small>
      <div class="d-none name"><code>interoperability_with_sce.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to integrate SuperCellCyto results
with cytometry data stored in SingleCellExperiment (SCE) objects, and
how to analyse SuperCellCyto output using Bioconductor packages that
take SCE objects as input.</p>
<p>We use a subsampled Levine_32dim dataset stored in an SCE object to
illustrate how to create supercells and conduct downstream analyses.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://phipsonlab.github.io/SuperCellCyto/">SuperCellCyto</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/qsbase/qs" class="external-link">qs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MarioniLab/scran/" class="external-link">scran</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LTLA/BiocSingular" class="external-link">BiocSingular</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bluster</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="preparing-sce-object">Preparing SCE object<a class="anchor" aria-label="anchor" href="#preparing-sce-object"></a>
</h2>
<p>We first load the subsampled Levine_32dim data, stored as a <a href="https://cran.r-project.org/web/packages/qs/index.html" class="external-link">qs</a>
using the <code>qread</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="st">"data/Levine_32dim_sce_sub.qs"</span><span class="op">)</span></span>
<span><span class="va">sce</span></span>
<span><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span><span class="co">#&gt; dim: 39 1400 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): counts</span></span>
<span><span class="co">#&gt; rownames(39): Time Cell_length ... file_number event_number</span></span>
<span><span class="co">#&gt; rowData names(3): channel_name marker_name marker_class</span></span>
<span><span class="co">#&gt; colnames(1400): cell_561 cell_321 ... cell_103890 cell_104094</span></span>
<span><span class="co">#&gt; colData names(3): population cell_id sample</span></span>
<span><span class="co">#&gt; reducedDimNames(0):</span></span>
<span><span class="co">#&gt; mainExpName: NULL</span></span>
<span><span class="co">#&gt; altExpNames(0):</span></span></code></pre></div>
<p>The data is stored in the <code>counts</code> assay. We will subset
it to include only markers we need to perform downstream analysis,
transform it using arcsinh transformation, and store the transformed
data in the <code>logcounts</code> assay.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"CD45RA"</span>, <span class="st">"CD133"</span>, <span class="st">"CD19"</span>, <span class="st">"CD22"</span>, <span class="st">"CD11b"</span>, <span class="st">"CD4"</span>, <span class="st">"CD8"</span>,</span>
<span>    <span class="st">"CD34"</span>, <span class="st">"Flt3"</span>, <span class="st">"CD20"</span>, <span class="st">"CXCR4"</span>, <span class="st">"CD235ab"</span>, <span class="st">"CD45"</span>, <span class="st">"CD123"</span>, <span class="st">"CD321"</span>,</span>
<span>    <span class="st">"CD14"</span>, <span class="st">"CD33"</span>, <span class="st">"CD47"</span>, <span class="st">"CD11c"</span>, <span class="st">"CD7"</span>, <span class="st">"CD15"</span>, <span class="st">"CD16"</span>, <span class="st">"CD44"</span>, <span class="st">"CD38"</span>,</span>
<span>    <span class="st">"CD13"</span>, <span class="st">"CD3"</span>, <span class="st">"CD61"</span>, <span class="st">"CD117"</span>,</span>
<span>    <span class="st">"CD49d"</span>, <span class="st">"HLA-DR"</span>, <span class="st">"CD64"</span>, <span class="st">"CD41"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keep only the relevant markers</span></span>
<span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span><span class="va">markers</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># to store arcsinh transformed data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html" class="external-link">asinh</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/dge.html" class="external-link">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sce</span></span>
<span><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span><span class="co">#&gt; dim: 32 1400 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(2): counts logcounts</span></span>
<span><span class="co">#&gt; rownames(32): CD45RA CD133 ... CD64 CD41</span></span>
<span><span class="co">#&gt; rowData names(3): channel_name marker_name marker_class</span></span>
<span><span class="co">#&gt; colnames(1400): cell_561 cell_321 ... cell_103890 cell_104094</span></span>
<span><span class="co">#&gt; colData names(3): population cell_id sample</span></span>
<span><span class="co">#&gt; reducedDimNames(0):</span></span>
<span><span class="co">#&gt; mainExpName: NULL</span></span>
<span><span class="co">#&gt; altExpNames(0):</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-supercellcyto">Run SuperCellCyto<a class="anchor" aria-label="anchor" href="#run-supercellcyto"></a>
</h2>
<p>SuperCellCyto requires input data in a <code>data.table</code>
format. Therefore, we need to extract the arcsinh-transformed data into
a <code>data.table</code> object, and add the sample information and IDs
of the cells.</p>
<p>Note that SCE typically stores cells as columns and features as rows.
SuperCellCyto, conversely, requires cells as rows and features as
columns, a format typical for cytometry data where we typically have
more cells than features. Hence, we will transpose the extracted data
accordingly when creating the <code>data.table</code> object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/exprs.html" class="external-link">exprs</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">sample</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">cell_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></span>
<span></span>
<span><span class="va">supercells</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSuperCellCyto.html">runSuperCellCyto</a></span><span class="op">(</span></span>
<span>    dt <span class="op">=</span> <span class="va">dt</span>,</span>
<span>    markers <span class="op">=</span> <span class="va">markers</span>,</span>
<span>    sample_colname <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>    cell_id_colname <span class="op">=</span> <span class="st">"cell_id"</span>,</span>
<span>    gam <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt;       CD45RA      CD133         CD19       CD22      CD11b          CD4</span></span>
<span><span class="co">#&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.3527464 0.36965658  0.052225408 0.15136864 0.38488737  0.196023673</span></span>
<span><span class="co">#&gt; 2: 0.4041729 0.11507111 -0.006932994 0.14693022 0.31907116 -0.003634473</span></span>
<span><span class="co">#&gt; 3: 0.2887375 0.36023125  0.056967849 0.07522713 0.24452473  0.029621008</span></span>
<span><span class="co">#&gt; 4: 0.4649379 0.08945479  0.103484348 0.11839183 0.14487231  1.042568045</span></span>
<span><span class="co">#&gt; 5: 0.9805149 0.19259931  2.047843479 0.63399673 0.19205448  0.069494473</span></span>
<span><span class="co">#&gt; 6: 0.5039989 0.04109535  1.140960742 0.16492283 0.02102912  0.071198534</span></span>
<span><span class="co">#&gt;            CD8       CD34       Flt3       CD20     CXCR4    CD235ab     CD45</span></span>
<span><span class="co">#&gt;          &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;     &lt;num&gt;      &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.007764969 3.50239704 0.34908410 0.05885608 0.8318448 0.08275919 4.150848</span></span>
<span><span class="co">#&gt; 2: 0.398832012 0.03705595 0.08254384 0.11077190 0.1816196 0.23423737 4.807796</span></span>
<span><span class="co">#&gt; 3: 0.141084382 2.86064160 0.15894138 0.09338509 0.5989438 0.28179014 3.957416</span></span>
<span><span class="co">#&gt; 4: 0.071286889 0.10101316 0.29710281 0.03730981 1.2497923 0.67063325 5.886074</span></span>
<span><span class="co">#&gt; 5: 0.119244014 0.18210858 0.18761215 1.92656431 1.6019596 0.55462384 4.901840</span></span>
<span><span class="co">#&gt; 6: 0.004411946 0.11332847 0.18281316 0.16633969 0.5100604 0.28425575 2.570437</span></span>
<span><span class="co">#&gt;         CD123     CD321         CD14         CD33     CD47     CD11c        CD7</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;    &lt;num&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.65958207 3.4777525  0.002602230  0.152636911 3.397630 0.5570696 0.12059033</span></span>
<span><span class="co">#&gt; 2: 0.01079346 0.7022473  0.040223896 -0.019154034 2.348988 0.3813772 3.63888594</span></span>
<span><span class="co">#&gt; 3: 0.68153776 3.1851073  0.015196514  0.117996726 2.756822 0.3060572 0.07848237</span></span>
<span><span class="co">#&gt; 4: 0.11592253 2.1491149 -0.007858091 -0.002039228 3.268248 0.2132838 1.08816761</span></span>
<span><span class="co">#&gt; 5: 0.62460814 2.2506667  0.075977004  0.514268184 3.562088 0.2269047 0.01379916</span></span>
<span><span class="co">#&gt; 6: 0.06874399 0.8415449  0.068690241  0.240470325 3.154016 0.4181508 0.07325880</span></span>
<span><span class="co">#&gt;          CD15        CD16     CD44      CD38      CD13        CD3       CD61</span></span>
<span><span class="co">#&gt;         &lt;num&gt;       &lt;num&gt;    &lt;num&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.63687911 0.195011598 4.262887 2.6031938 0.4192431 0.46531929 0.06761204</span></span>
<span><span class="co">#&gt; 2: 0.17664753 0.905724996 1.632231 2.8565129 0.2514765 0.27068380 0.25558748</span></span>
<span><span class="co">#&gt; 3: 0.44514407 0.026423501 2.874195 1.9066412 0.4908399 0.24716531 0.17950440</span></span>
<span><span class="co">#&gt; 4: 0.08441551 0.004227474 3.640311 0.5495787 0.2311405 5.36168058 0.39291676</span></span>
<span><span class="co">#&gt; 5: 0.14494562 0.252655577 2.822493 5.0658843 0.5187125 0.33558106 0.19615231</span></span>
<span><span class="co">#&gt; 6: 0.30214595 0.281831160 3.819350 5.8639208 1.0289835 0.07946019 0.08158021</span></span>
<span><span class="co">#&gt;          CD117     CD49d     HLA-DR       CD64       CD41 sample</span></span>
<span><span class="co">#&gt;          &lt;num&gt;     &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:  1.19031991 1.3604618 2.75321307 0.16150006 0.18985821     H1</span></span>
<span><span class="co">#&gt; 2:  0.06541793 0.4496903 0.14374144 0.18547915 0.06282481     H1</span></span>
<span><span class="co">#&gt; 3:  0.83249351 0.9205626 2.58482319 0.20073796 0.21266848     H1</span></span>
<span><span class="co">#&gt; 4:  0.29209802 0.4707183 0.17818566 0.04568237 0.07765066     H1</span></span>
<span><span class="co">#&gt; 5:  0.10129956 1.3608945 2.20287695 0.09954007 0.17256851     H1</span></span>
<span><span class="co">#&gt; 6: -0.01764885 1.4263210 0.07484084 0.06353135 0.06840618     H1</span></span>
<span><span class="co">#&gt;              SuperCellId</span></span>
<span><span class="co">#&gt;                   &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: SuperCell_1_Sample_H1</span></span>
<span><span class="co">#&gt; 2: SuperCell_2_Sample_H1</span></span>
<span><span class="co">#&gt; 3: SuperCell_3_Sample_H1</span></span>
<span><span class="co">#&gt; 4: SuperCell_4_Sample_H1</span></span>
<span><span class="co">#&gt; 5: SuperCell_5_Sample_H1</span></span>
<span><span class="co">#&gt; 6: SuperCell_6_Sample_H1</span></span></code></pre></div>
<p>We can now embed the supercell ID in the <code>colData</code> of our
SCE object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">supercell_id</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">supercells</span><span class="op">$</span><span class="va">supercell_cell_map</span><span class="op">$</span><span class="va">SuperCellID</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; DataFrame with 6 rows and 4 columns</span></span>
<span><span class="co">#&gt;          population     cell_id   sample           supercell_id</span></span>
<span><span class="co">#&gt;            &lt;factor&gt; &lt;character&gt; &lt;factor&gt;               &lt;factor&gt;</span></span>
<span><span class="co">#&gt; cell_561  Basophils    cell_561       H1 SuperCell_94_Sample_H1</span></span>
<span><span class="co">#&gt; cell_321  Basophils    cell_321       H1 SuperCell_51_Sample_H1</span></span>
<span><span class="co">#&gt; cell_153  Basophils    cell_153       H1 SuperCell_29_Sample_H1</span></span>
<span><span class="co">#&gt; cell_74   Basophils     cell_74       H1 SuperCell_51_Sample_H1</span></span>
<span><span class="co">#&gt; cell_228  Basophils    cell_228       H1 SuperCell_51_Sample_H1</span></span>
<span><span class="co">#&gt; cell_146  Basophils    cell_146       H1 SuperCell_25_Sample_H1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyse-supercells-as-sce-object">Analyse Supercells as SCE object<a class="anchor" aria-label="anchor" href="#analyse-supercells-as-sce-object"></a>
</h2>
<p>As the number of supercells is less than the number of cells in our
SCE object, we store the supercell expression matrix as a separate SCE
object. This then allows us to use Bioconductor packages to analyse our
supercells.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">supercell_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>logcounts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span></span>
<span>        <span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span><span class="op">[</span>, <span class="va">markers</span>, with <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>    colData <span class="op">=</span> <span class="fu">DataFrame</span><span class="op">(</span></span>
<span>        SuperCellId <span class="op">=</span> <span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span><span class="op">$</span><span class="va">SuperCellId</span>,</span>
<span>        sample <span class="op">=</span> <span class="va">supercells</span><span class="op">$</span><span class="va">supercell_expression_matrix</span><span class="op">$</span><span class="va">sample</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">supercell_sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">colData</span><span class="op">(</span><span class="va">supercell_sce</span><span class="op">)</span><span class="op">$</span><span class="va">SuperCellId</span></span>
<span><span class="va">supercell_sce</span></span>
<span><span class="co">#&gt; class: SingleCellExperiment </span></span>
<span><span class="co">#&gt; dim: 32 280 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): logcounts</span></span>
<span><span class="co">#&gt; rownames(32): CD45RA CD133 ... CD64 CD41</span></span>
<span><span class="co">#&gt; rowData names(0):</span></span>
<span><span class="co">#&gt; colnames(280): SuperCell_1_Sample_H1 SuperCell_2_Sample_H1 ...</span></span>
<span><span class="co">#&gt;   SuperCell_139_Sample_H2 SuperCell_140_Sample_H2</span></span>
<span><span class="co">#&gt; colData names(2): SuperCellId sample</span></span>
<span><span class="co">#&gt; reducedDimNames(0):</span></span>
<span><span class="co">#&gt; mainExpName: NULL</span></span>
<span><span class="co">#&gt; altExpNames(0):</span></span></code></pre></div>
<p>The code above essentially transpose the supercell expression matrix,
making supercells columns and markers rows, and store it in the
<code>logcounts</code> assay of our new SCE object. We also populate the
<code>colData</code> with SuperCellId and the sample name for each
supercell.</p>
<p>With the supercell expression matrix now in an SCE format, we can
perform downstream analyses such as clustering and and drawing UMAP
plots using Bioconductor packages.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">supercell_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/fixedPCA.html" class="external-link">fixedPCA</a></span><span class="op">(</span></span>
<span>    <span class="va">supercell_sce</span>,</span>
<span>    rank <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    subset.row <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    BSPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocSingular/man/BiocSingularParam.html" class="external-link">RandomParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">supercell_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html" class="external-link">runUMAP</a></span><span class="op">(</span><span class="va">supercell_sce</span>, dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/clusterCells.html" class="external-link">clusterCells</a></span><span class="op">(</span></span>
<span>    <span class="va">supercell_sce</span>, use.dimred <span class="op">=</span> <span class="st">"PCA"</span>,</span>
<span>    BLUSPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bluster/man/NNGraphParam-class.html" class="external-link">SNNGraphParam</a></span><span class="op">(</span>cluster.fun <span class="op">=</span> <span class="st">"leiden"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/colLabels.html" class="external-link">colLabels</a></span><span class="op">(</span><span class="va">supercell_sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">clusters</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotReducedDim.html" class="external-link">plotReducedDim</a></span><span class="op">(</span><span class="va">supercell_sce</span>, dimred <span class="op">=</span> <span class="st">"UMAP"</span>, colour_by <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span></span></code></pre></div>
<p><img src="interoperability_with_sce_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Any functions which operate on SCE object should work. For example,
we can use <code>plotExpression</code> in <code>scater</code> package to
create violin plots of the markers against clusters.</p>
<p>Note, the y-axis says “logcounts”, but the data is actually arcsinh
transformed, not log transformed.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotExpression.html" class="external-link">plotExpression</a></span><span class="op">(</span></span>
<span>    <span class="va">supercell_sce</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"CD8"</span>, <span class="st">"CD19"</span>, <span class="st">"CD34"</span>, <span class="st">"CD11b"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"label"</span>, colour_by <span class="op">=</span> <span class="st">"sample"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="interoperability_with_sce_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="transfer-information-from-supercells-sce-object-to-single-cell-sce-object">Transfer information from supercells SCE object to single cell SCE
object<a class="anchor" aria-label="anchor" href="#transfer-information-from-supercells-sce-object-to-single-cell-sce-object"></a>
</h2>
<p>To transfer analysis results (e.g., clusters) from the supercell SCE
object back to the single-cell SCE object, we need to do some data
wrangling. It is vital to ensure that the order of the analysis results
(e.g., clusters) aligns with the cell order in the SCE object.</p>
<p>Using the cluster information as an example, we need to first extract
the <code>colData</code> of the SCE objects into two separate
<code>data.table</code> objects. We then use
<code>merge.data.table</code> to match and merge them using the
supercell ID as the common identifiers. Make sure you set the
<code>sort</code> parameter to FALSE and set <code>x</code> to the
<code>colData</code> of your single cell SCE object. This ensures that
the order of the resulting <code>data.table</code> aligns with the order
of the <code>colData</code> of our single-cell SCE object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cell_id_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">supercell_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">supercell_sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cell_id_sce_with_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge.data.table</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">cell_id_sce</span>,</span>
<span>    y <span class="op">=</span> <span class="va">supercell_cluster</span>,</span>
<span>    by.x <span class="op">=</span> <span class="st">"supercell_id"</span>,</span>
<span>    by.y <span class="op">=</span> <span class="st">"SuperCellId"</span>,</span>
<span>    sort <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can then add the cluster assignment as a column in the
<code>colData</code> of our single-cell SCE object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">cell_id_sce_with_clusters</span><span class="op">$</span><span class="va">label</span></span></code></pre></div>
<p>Visualise them as UMAP plot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/fixedPCA.html" class="external-link">fixedPCA</a></span><span class="op">(</span><span class="va">sce</span>, rank <span class="op">=</span> <span class="fl">10</span>, subset.row <span class="op">=</span> <span class="cn">NULL</span>, BSPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocSingular/man/BiocSingularParam.html" class="external-link">RandomParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html" class="external-link">runUMAP</a></span><span class="op">(</span><span class="va">sce</span>, dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotReducedDim.html" class="external-link">plotReducedDim</a></span><span class="op">(</span><span class="va">sce</span>, dimred <span class="op">=</span> <span class="st">"UMAP"</span>, colour_by <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span></code></pre></div>
<p><img src="interoperability_with_sce_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Or violin plot to see the distribution of their marker expressions.
Note, the y-axis says “logcounts”, but the data is actually arcsinh
transformed, not log transformed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotExpression.html" class="external-link">plotExpression</a></span><span class="op">(</span></span>
<span>    <span class="va">sce</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"CD8"</span>, <span class="st">"CD19"</span>, <span class="st">"CD34"</span>, <span class="st">"CD11b"</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"cluster"</span>, colour_by <span class="op">=</span> <span class="st">"sample"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="interoperability_with_sce_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] data.table_1.17.8           bluster_1.18.0             </span></span>
<span><span class="co">#&gt;  [3] scater_1.36.0               ggplot2_3.5.2              </span></span>
<span><span class="co">#&gt;  [5] BiocSingular_1.24.0         scran_1.36.0               </span></span>
<span><span class="co">#&gt;  [7] scuttle_1.18.0              SingleCellExperiment_1.30.1</span></span>
<span><span class="co">#&gt;  [9] SummarizedExperiment_1.38.1 Biobase_2.68.0             </span></span>
<span><span class="co">#&gt; [11] GenomicRanges_1.60.0        GenomeInfoDb_1.44.1        </span></span>
<span><span class="co">#&gt; [13] IRanges_2.42.0              S4Vectors_0.46.0           </span></span>
<span><span class="co">#&gt; [15] BiocGenerics_0.54.0         generics_0.1.4             </span></span>
<span><span class="co">#&gt; [17] MatrixGenerics_1.20.0       matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt; [19] qs_0.27.3                   SuperCellCyto_0.99.0       </span></span>
<span><span class="co">#&gt; [21] BiocStyle_2.36.0           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gridExtra_2.3           rlang_1.1.6             magrittr_2.0.3         </span></span>
<span><span class="co">#&gt;  [4] compiler_4.5.1          systemfonts_1.2.3       vctrs_0.6.5            </span></span>
<span><span class="co">#&gt;  [7] pkgconfig_2.0.3         crayon_1.5.3            fastmap_1.2.0          </span></span>
<span><span class="co">#&gt; [10] XVector_0.48.0          labeling_0.4.3          SuperCell_1.0.1        </span></span>
<span><span class="co">#&gt; [13] rmarkdown_2.29          UCSC.utils_1.4.0        ggbeeswarm_0.7.2       </span></span>
<span><span class="co">#&gt; [16] ragg_1.4.0              xfun_0.52               cachem_1.1.0           </span></span>
<span><span class="co">#&gt; [19] beachmat_2.24.0         jsonlite_2.0.0          DelayedArray_0.34.1    </span></span>
<span><span class="co">#&gt; [22] BiocParallel_1.42.1     irlba_2.3.5.1           parallel_4.5.1         </span></span>
<span><span class="co">#&gt; [25] cluster_2.1.8.1         R6_2.6.1                bslib_0.9.0            </span></span>
<span><span class="co">#&gt; [28] RColorBrewer_1.1-3      limma_3.64.3            jquerylib_0.1.4        </span></span>
<span><span class="co">#&gt; [31] Rcpp_1.1.0              bookdown_0.43           knitr_1.50             </span></span>
<span><span class="co">#&gt; [34] FNN_1.1.4.1             Matrix_1.7-3            igraph_2.1.4           </span></span>
<span><span class="co">#&gt; [37] tidyselect_1.2.1        abind_1.4-8             yaml_2.3.10            </span></span>
<span><span class="co">#&gt; [40] viridis_0.6.5           stringfish_0.17.0       codetools_0.2-20       </span></span>
<span><span class="co">#&gt; [43] lattice_0.22-7          tibble_3.3.0            plyr_1.8.9             </span></span>
<span><span class="co">#&gt; [46] withr_3.0.2             evaluate_1.0.4          desc_1.4.3             </span></span>
<span><span class="co">#&gt; [49] RcppParallel_5.1.10     pillar_1.11.0           BiocManager_1.30.26    </span></span>
<span><span class="co">#&gt; [52] scales_1.4.0            RApiSerialize_0.1.4     glue_1.8.0             </span></span>
<span><span class="co">#&gt; [55] metapod_1.16.0          tools_4.5.1             BiocNeighbors_2.2.0    </span></span>
<span><span class="co">#&gt; [58] ScaledMatrix_1.16.0     locfit_1.5-9.12         RANN_2.6.2             </span></span>
<span><span class="co">#&gt; [61] fs_1.6.6                cowplot_1.2.0           grid_4.5.1             </span></span>
<span><span class="co">#&gt; [64] edgeR_4.6.3             GenomeInfoDbData_1.2.14 beeswarm_0.4.0         </span></span>
<span><span class="co">#&gt; [67] vipor_0.4.7             cli_3.6.5               rsvd_1.0.5             </span></span>
<span><span class="co">#&gt; [70] textshaping_1.0.1       S4Arrays_1.8.1          viridisLite_0.4.2      </span></span>
<span><span class="co">#&gt; [73] dplyr_1.1.4             uwot_0.2.3              gtable_0.3.6           </span></span>
<span><span class="co">#&gt; [76] sass_0.4.10             digest_0.6.37           SparseArray_1.8.1      </span></span>
<span><span class="co">#&gt; [79] ggrepel_0.9.6           dqrng_0.4.1             htmlwidgets_1.6.4      </span></span>
<span><span class="co">#&gt; [82] farver_2.1.2            htmltools_0.5.8.1       pkgdown_2.1.3          </span></span>
<span><span class="co">#&gt; [85] lifecycle_1.0.4         httr_1.4.7              statmod_1.5.0</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Givanna Putri, George Howitt, Felix Marsh-Wakefield, Thomas Ashhurst, Belinda Phipson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
