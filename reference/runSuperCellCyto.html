<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Run SuperCell on cytometry data stored as a data.table object.
This is a wrapper function around the SCImplify function in the
SuperCell R package by Bilous et.al, 2022.
We have enhanced it by adding the capacity to "supercell" multiple samples
in parallel through the use of BiocParallel, and by adding support to
"supercell" cytometry data.
More explanations are given in various sections below, and are further
expanded in our vignette.'><title>Run SuperCell for cytometry data — runSuperCellCyto • SuperCellCyto</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run SuperCell for cytometry data — runSuperCellCyto"><meta property="og:description" content='Run SuperCell on cytometry data stored as a data.table object.
This is a wrapper function around the SCImplify function in the
SuperCell R package by Bilous et.al, 2022.
We have enhanced it by adding the capacity to "supercell" multiple samples
in parallel through the use of BiocParallel, and by adding support to
"supercell" cytometry data.
More explanations are given in various sections below, and are further
expanded in our vignette.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SuperCellCyto</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how_to_supercell.html">How to create supercells</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run SuperCell for cytometry data</h1>
      
      <div class="d-none name"><code>runSuperCellCyto.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run SuperCell on cytometry data stored as a data.table object.
This is a wrapper function around the <code>SCImplify</code> function in the
SuperCell R package by Bilous et.al, 2022.
We have enhanced it by adding the capacity to "supercell" multiple samples
in parallel through the use of BiocParallel, and by adding support to
"supercell" cytometry data.
More explanations are given in various sections below, and are further
expanded in our vignette.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">runSuperCellCyto</span><span class="op">(</span></span>
<span>  <span class="va">dt</span>,</span>
<span>  <span class="va">markers</span>,</span>
<span>  <span class="va">sample_colname</span>,</span>
<span>  <span class="va">cell_id_colname</span>,</span>
<span>  gam <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  k_knn <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  load_balancing <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dt</dt>
<dd><p>data.table object containing the cytometry data.
Rows represent cells, columns represent markers.
If this is not a data.table object, the function will warn you about it,
and then try to convert it to a data.table object.</p></dd>


<dt>markers</dt>
<dd><p>character vector specifying the markers to run SuperCell on.</p></dd>


<dt>sample_colname</dt>
<dd><p>character specifying the column in <code>dt</code> that denotes
the sample of a cell.</p></dd>


<dt>cell_id_colname</dt>
<dd><p>character specifying the column in <code>dt</code> that denotes
the unique ID of a cell.</p></dd>


<dt>gam</dt>
<dd><p>numeric specifying the gamma value to be used by SuperCell.
Default to 20.</p></dd>


<dt>k_knn</dt>
<dd><p>numeric specifying the k value to be used by SuperCell's knn.
Default to 5.</p></dd>


<dt>BPPARAM</dt>
<dd><p>A BiocParallelParam specifying how the samples
should be "supercelled" in parallel.
Default to SerialParam, meaning the samples will be processed in serial.
Please go the section on parallel processing for more details
on how to best supercell multiple samples in parallel.</p></dd>


<dt>load_balancing</dt>
<dd><p>logical whether load balancing should be performed when
multiple samples are to "supercelled" in parallel.
Please go the section on parallel processing for more details
on how to best supercell multiple samples in parallel.
Default to FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>runSuperCellCyto</code> will return a list with the following components:</p><dl><dt><code>supercell_object</code>:</dt>
<dd><p>A list containing the object returned by
SCimplify function. One object per sample.</p></dd>

<dt><code>supercell_expression_matrix</code>:</dt>
<dd><p>A data.table containing
the marker expression of all the supercells.
These are computed by taking the average marker expression of the cells
captured by each supercell.</p></dd>

<dt><code>supercell_cell_map</code>:</dt>
<dd><p>A data.table showing which cell is
captured by which supercell. This is very useful if you intend to work out
which supercell captures which cell.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="supercell-multiple-samples-in-parallel">Supercell multiple samples in parallel<a class="anchor" aria-label="anchor" href="#supercell-multiple-samples-in-parallel"></a></h2>
    

<p>For the function to supercell multiple samples in parallel, you will need to supply
a BiocParallelParam (as BPPARAM parameter) that leverages parallel evaluation,
e.g., MulticoreParam or SnowParam.
Importantly, it is also recommended to set their number of tasks (task parameter) as
the number of samples you have, and to set the <code>load_balancing</code> parameter to TRUE.
That way, the jobs that are handling the large samples are responsible (mostly)
for only that sample, and that the small ones are handled by other jobs which are
handling much smaller samples.</p>
    </div>
    <div class="section level2">
    <h2 id="what-is-cell-id-colname">What is <code>cell_id_colname</code><a class="anchor" aria-label="anchor" href="#what-is-cell-id-colname"></a></h2>
    

<p>This is a column in <code>dt</code> containing a unique identifier for each cell.
Commonly, you will have to manually create this column as a FCS file does not
typically has a field which uniquely identify each cell.
You can create this ID by giving the cells a numeric value of 1 to however many
you have, and store this as a column in <code>dt</code>.
If you don't know how to do this, refer to our vignette.</p>
    </div>
    <div class="section level2">
    <h2 id="what-constitute-a-sample">What constitute a sample<a class="anchor" aria-label="anchor" href="#what-constitute-a-sample"></a></h2>
    

<p>This function is designed such that all the samples are processed,
independent of each other.
Because of this, you can safely assume that each supercell will contain only
cells from exactly one sample.</p>
<p>The function will work out which cells come from which sample based on what is
specified in the <code>sample_colname</code> column.
This is why it is critical to specify what this column is.</p>
<p>For most purposes, a sample represents a biological sample in your experiment.
You may be thinking, is it then possible to use this in a different context,
say creating supercells for each population or cluster rather than a biological
sample?
The short answer is yes, and we address this in our vignette.</p>
    </div>
    <div class="section level2">
    <h2 id="computing-pca">Computing PCA<a class="anchor" aria-label="anchor" href="#computing-pca"></a></h2>
    

<p>By default, the function will start by computing PCA from all the markers
specified in <code>markers</code> parameter, and that 10 PCs are computed.
If there are less than 10 markers in the <code>markers</code> parameter, then the
number of PCs are set to however many markers there are in the <code>markers</code> parameter.</p>
<p>Notably, <em>no</em> scaling or transformation were done on the markers' expressions
prior to computing the PCs.</p>
<p><code>irlba</code> is not used to calculate PCA as cytometry data tend to only have a
handful of features (markers) compared to scRNAseq data.
Hence there is very little gain.</p>
    </div>
    <div class="section level2">
    <h2 id="setting-the-supercell-graining-level">Setting the supercell graining level<a class="anchor" aria-label="anchor" href="#setting-the-supercell-graining-level"></a></h2>
    

<p>How many supercells will I get for my dataset? or to phrase it in another way,
can I estimate how many cells will be captured within each supercell?
That depends on what you set the <code>gam</code> parameter to.</p>
<p>The <code>gam</code> parameter is represented by the formula <code>gamma=n_cells/n_supercells</code>
where <code>n_cells</code> denotes the number of cells and <code>n_supercells</code> denotes the
number of supercells to be created.
By resolving this formula, we can roughly estimate how many supercells you will
get at the end, and thus, <em>approximately</em> how many cells will be captured
within each supercell.</p>
<p>Generally, the smaller the <code>gam</code> parameter is, the more supercells
you will get.
Say for instance you have 10,000 cells.
If <code>gam</code> is set to 10, you will end up with about 1,000 supercells, whereas
if <code>gam</code> is set to 50, you will end up with about 200 supercells.</p>
<p>Conversely, as you get more supercells (i.e. smaller <code>gam</code> value),
the smaller their size will be.
In other words, each of them will be capturing less cells.
Importantly, one cannot expect all the supercells to be of the same size.
Some will capture more/less cells than the other, and that is it not trivial
to estimate how many will be captured beforehand.
We may look into swapping the <code>gam</code> value to how many cells to be captured
within each supercell <em>in the future</em>.
More thoughts are required into whether this make sense.</p>
<p>Lastly, for now, a <code>gam</code> value for all your samples
(read the section above if you are not sure what I mean by samples here).
<em>In the future</em>, we can perhaps look into setting different <code>gam</code> values
for different samples.</p>
    </div>
    <div class="section level2">
    <h2 id="computing-knn-network">Computing kNN network<a class="anchor" aria-label="anchor" href="#computing-knn-network"></a></h2>
    

<p>The parameter <code>k_knn</code> governs and the k value used to compute the
single-cell kNN network.
Actual (not approximate) kNN network is created, and walktrap algorithm is
used to form supercells from the kNN network.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Givanna Putri</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate some data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cyto_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="simCytoData.html">simCytoData</a></span><span class="op">(</span>nmarkers <span class="op">=</span> <span class="fl">10</span>, ncells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2000</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setup the columns designating the markers, samples, and cell IDs</span></span></span>
<span class="r-in"><span><span class="va">marker_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Marker_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sample_col</span> <span class="op">&lt;-</span> <span class="st">"Sample"</span></span></span>
<span class="r-in"><span><span class="va">cell_id_col</span> <span class="op">&lt;-</span> <span class="st">"Cell_Id"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">supercell_dat</span> <span class="op">&lt;-</span> <span class="fu">runSuperCellCyto</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cyto_dat</span>, <span class="va">marker_col</span>,</span></span>
<span class="r-in"><span>    <span class="va">sample_col</span>, <span class="va">cell_id_col</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Givanna Putri, Belinda Phipson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

