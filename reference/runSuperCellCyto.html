<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function creates supercells for a cytometry data formatted
as a data.table object using the SuperCellCyto algorithm.
Please make sure you read additional details below to better understand
what the function does and how it works."><title>Run SuperCellCyto on Cytometry Data — runSuperCellCyto • SuperCellCyto</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run SuperCellCyto on Cytometry Data — runSuperCellCyto"><meta property="og:description" content="This function creates supercells for a cytometry data formatted
as a data.table object using the SuperCellCyto algorithm.
Please make sure you read additional details below to better understand
what the function does and how it works."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SuperCellCyto</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how_to_create_supercells.html">How to create supercells</a>
    <a class="dropdown-item" href="../articles/how_to_prepare_data.html">How to Prepare Data for SuperCellCyto</a>
    <a class="dropdown-item" href="../articles/interoperability_with_sce.html">Interoperability with SingleCellExperiment</a>
    <a class="dropdown-item" href="../articles/interoperability_with_seurat.html">Interoperability with Seurat</a>
    <a class="dropdown-item" href="../articles/using_supercellcyto_for_stratified_summarising.html">Using SuperCellCyto for Stratified Summarising</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run SuperCellCyto on Cytometry Data</h1>
      
      <div class="d-none name"><code>runSuperCellCyto.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates supercells for a cytometry data formatted
as a data.table object using the SuperCellCyto algorithm.</p>
<p>Please make sure you read additional details below to better understand
what the function does and how it works.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">runSuperCellCyto</span><span class="op">(</span></span>
<span>  <span class="va">dt</span>,</span>
<span>  <span class="va">markers</span>,</span>
<span>  <span class="va">sample_colname</span>,</span>
<span>  <span class="va">cell_id_colname</span>,</span>
<span>  gam <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  k_knn <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  load_balancing <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dt</dt>
<dd><p>A data.table object containing cytometry data where rows represent
cells and columns represent markers.
If this is a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a> object, the function will try to convert it to a data.table object.
A warning message will be displayed when this happens.
Otherwise, it will terminate.</p></dd>


<dt>markers</dt>
<dd><p>A character vector identifying the markers to create supercells with.</p></dd>


<dt>sample_colname</dt>
<dd><p>A character string identifying the column in <code>dt</code> that denotes the sample of a cell.</p></dd>


<dt>cell_id_colname</dt>
<dd><p>A character string identifying the column in <code>dt</code> representing each cell's unique ID.</p></dd>


<dt>gam</dt>
<dd><p>A numeric value specifying the gamma value which regulates the number of supercells generated.
Defaults to 20.</p></dd>


<dt>k_knn</dt>
<dd><p>A numeric value specifying the k value (number of neighbours) used
to build the kNN network.
Defaults to 5.</p></dd>


<dt>BPPARAM</dt>
<dd><p>A BiocParallelParam object specifying parallel processing settings.
Defaults to <code>SerialParam</code>, meaning the samples will be processed sequentially one after the other.
Refer to additional details section below on parallel processing for more details.</p></dd>


<dt>load_balancing</dt>
<dd><p>A logical value  indicating whether to use a custom load balancing
scheme when processing multiple samples in parallel.
Defaults to FALSE.
Refer to additional details section below on parallel processing for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with the following components:</p><ul><li><p><code>supercell_object</code>: A list containing the object returned by
SCimplify function.
One object per sample.
This object is critical for recomputing supercells in the future.
Hence do not discard it.</p></li>
<li><p><code>supercell_expression_matrix</code>:  A data.table object that contains the marker expression for each supercell.
These marker expressions are computed by calculating the mean of the marker expressions across all cells
within each individual supercell.</p></li>
<li><p><code>supercell_cell_map</code>: A data.table that maps each cell to its corresponding supercell.
This table is essential for identifying the specific supercell each cell has been allocated to.
It proves particularly useful for analyses that require one to expand the supercells
to the individual cell level.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="parallel-processing">Parallel Processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a></h2>
    

<p>SuperCellCyto can process multiple samples simultaneously in parallel.
This can drastically bring down processing time for dataset with a large number of samples.
To enable this feature, set the <code>BPPARAM</code> parameter to either a
MulticoreParam object or a SnowParam object.
Importantly, it is also recommended to set the number of tasks (i.e., the <code>task</code>
parameter in either MulticoreParam or SnowParam object)
to <strong>the number of samples in the dataset</strong>.</p>
<p>Furthermore, we also recommend setting <code>load_balancing</code> parameter to TRUE.
This ensures optimal distribution of samples across multiple cores, and is
particularly important if your samples are of varying sizes (number of cells).</p>
    </div>
    <div class="section level2">
    <h2 id="cell-id-and-sample-definitions">Cell ID and Sample Definitions<a class="anchor" aria-label="anchor" href="#cell-id-and-sample-definitions"></a></h2>
    

<p>The <code>cell_id_colname</code> parameter specifies the column in <code>dt</code> that denotes
the unique identifier for each cell.
It is perfectly normal to not have this column in your dataset by default.
The good news is that <strong>it is trivial to create one</strong>.
You can create a new vector containing a sequence of numbers from 1 to however
many cells you have, and append this vector as a new column in your dataset.
Refer to our vignette on how to do this.</p>
<p>The <code>sample_colname</code> parameter specifies the column in <code>dt</code> that denotes
the sample a cell came from.
By default, SuperCellCyto creates supercells for each sample independent of other samples.
This ensures each supercell to only contain cells from <strong>exactly</strong> one sample.</p>
<p>What constitute a sample?
For most purposes, a sample represents a biological sample in your experiment.
You may be thinking, is it then possible to use this in a different context,
say creating supercells for each population or cluster rather than a biological
sample?
The short answer is yes, and we address this in our vignette.</p>
    </div>
    <div class="section level2">
    <h2 id="computing-pca">Computing PCA<a class="anchor" aria-label="anchor" href="#computing-pca"></a></h2>
    

<p>The function will start by computing PCA from all the markers
specified in <code>markers</code> parameter.
By default, the number of PCs calculated is set to 10.
If there is less than 10 markers in the <code>markers</code> parameter, then the
number of PCs is set to however many markers there are in the <code>markers</code> parameter.</p>
<p>Notably, <em>no</em> scaling or transformation were done on the markers' expressions
prior to computing the PCs.</p>
<p>The function does not use <code>irlba</code> to calculate PCA.
There is very little gain to use it for cytometry data because of the relatively
tiny number of features (markers) in the data.</p>
    </div>
    <div class="section level2">
    <h2 id="setting-supercell-s-resolution">Setting Supercell's Resolution<a class="anchor" aria-label="anchor" href="#setting-supercell-s-resolution"></a></h2>
    

<p>The <code>gam</code> parameter influences the number of supercells created per sample.
A lower <code>gam</code> value results in more, and thus generally smaller supercells, and vice versa.</p>
<p>To estimate how many supercells we will get for our dataset, it is important
to understand how the <code>gam</code> value is interpreted in the context of number of cells
in a sample.</p>
<p><code>gam=n_cells/n_supercells</code>
where <code>n_cells</code> denotes the number of cells and <code>n_supercells</code> denotes the
number of supercells to be created.</p>
<p>By resolving the formula above, we can roughly estimate how many supercells we will
get per sample.
For example, say we have 2 samples, sample A and B.
Sample A has 10,000 cells, while sample B has 5,000 cells:</p><ul><li><p>If <code>gam</code> is set to 10, we will end up with 1,000 supercells for sample A
and 500 supercells for sample B, a total of 1,500 supercells.</p></li>
<li><p>If <code>gam</code> is set to 50, we will end up with 200 supercells for sample A
and 100 supercells for sample B, a total of 300 supercells.</p></li>
</ul><p><em>Importantly</em>, one cannot expect all the supercells to be of the same size.
Some will capture more/less cells than others.
It is not trivial to estimate how many cells will be captured in each supercell beforehand.</p>
    </div>
    <div class="section level2">
    <h2 id="computing-knn-network">Computing kNN network<a class="anchor" aria-label="anchor" href="#computing-knn-network"></a></h2>
    

<p>To create supercells, a kNN (k-Nearest Neighbors) network is constructed based
on the <code>k_knn</code> parameter which dictates the number of neighbours (for each cell) used to create
the network.
An actual (not approximate) kNN network is created.</p>
<p>A walktrap algorithm then uses this network to group cells into supercells.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Givanna Putri</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate some data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cyto_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="simCytoData.html">simCytoData</a></span><span class="op">(</span>nmarkers <span class="op">=</span> <span class="fl">10</span>, ncells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2000</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setup the columns designating the markers, samples, and cell IDs</span></span></span>
<span class="r-in"><span><span class="va">marker_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Marker_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sample_col</span> <span class="op">&lt;-</span> <span class="st">"Sample"</span></span></span>
<span class="r-in"><span><span class="va">cell_id_col</span> <span class="op">&lt;-</span> <span class="st">"Cell_Id"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">supercell_dat</span> <span class="op">&lt;-</span> <span class="fu">runSuperCellCyto</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cyto_dat</span>, <span class="va">marker_col</span>,</span></span>
<span class="r-in"><span>    <span class="va">sample_col</span>, <span class="va">cell_id_col</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Givanna Putri, George Howitt, Felix Marsh-Wakefield, Thomas Ashhurst, Belinda Phipson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

